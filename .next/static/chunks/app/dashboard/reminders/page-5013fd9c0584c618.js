(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[85],{3807:function(e,s,t){Promise.resolve().then(t.bind(t,25642))},25642:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return x}});var n=t(57437),a=t(2265),l=t(58714),r=t(49231),i=t(8792);function c(e){return e?(0,r.WU)(new Date(e),"dd.MM.yyyy HH:mm"):""}function d(e){let s=new Date(e);return Math.floor(Math.abs(new Date().getTime()-s.getTime())/864e5)}function x(){let[e,s]=(0,a.useState)([]),[t,r]=(0,a.useState)([]),[x,o]=(0,a.useState)(!0),[m,p]=(0,a.useState)(null),[h,g]=(0,a.useState)(!1),[u,f]=(0,a.useState)(null),[y,w]=(0,a.useState)(!1),j=async()=>{o(!0),p(null);try{let e=(0,l.createClientComponentClient)(),{data:{session:t}}=await e.auth.getSession();if(!t){g(!1),o(!1);return}g(!0);let n=await fetch("/api/get-sent-emails",{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)throw Error("Kunne ikke hente e-poster");let a=(await n.json()).emails||[];s(a);let i=new Date;i.setDate(i.getDate()-2);let c=a.filter(e=>!e.clicked_at&&!e.reminder_sent_at&&new Date(e.sent_at)<i);r(c)}catch(e){console.error("Error fetching emails:",e),p(e.message||"Feil ved henting av e-poster")}finally{o(!1)}};(0,a.useEffect)(()=>{j()},[]);let N=async()=>{w(!0),f(null);try{let e=await fetch("/api/send-reminders",{method:"POST",headers:{"Content-Type":"application/json"}}),s=await e.json();if(!e.ok)throw Error(s.error||"Feil ved sending av p\xe5minnelser");f({success:!0,message:s.message||"".concat(s.sentCount," p\xe5minnelser ble sendt")}),await j()}catch(e){console.error("Error sending reminders:",e),f({success:!1,message:e.message})}finally{w(!1)}};return h?(0,n.jsx)("div",{className:"min-h-screen bg-gray-100 p-6",children:(0,n.jsxs)("div",{className:"max-w-6xl mx-auto bg-white rounded shadow p-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold",children:"Automatiske p\xe5minnelser"}),(0,n.jsxs)("div",{className:"flex space-x-3",children:[(0,n.jsx)("button",{onClick:N,disabled:y||0===t.length,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors flex items-center disabled:opacity-50",children:y?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Sender p\xe5minnelser..."]}):"Send p\xe5minnelser (".concat(t.length,")")}),(0,n.jsxs)("button",{onClick:j,disabled:x,className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors flex items-center disabled:opacity-50",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Oppdater"]})]})]}),u&&(0,n.jsx)("div",{className:"p-4 mb-6 rounded ".concat(u.success?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:u.message}),x&&(0,n.jsxs)("div",{className:"bg-gray-100 p-4 rounded text-gray-700 flex items-center justify-center",children:[(0,n.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Laster inn..."]}),m&&(0,n.jsxs)("div",{className:"bg-red-100 text-red-700 p-4 rounded mb-6",children:["Feil ved henting av data: ",m]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Kunder som trenger p\xe5minnelse"}),x||0!==t.length?(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Navn"}),(0,n.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"E-post"}),(0,n.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sendt dato"}),(0,n.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dager siden"}),(0,n.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),(0,n.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.name}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.email}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:c(e.sent_at)}),(0,n.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[d(e.sent_at)," dager"]}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,n.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800",children:"P\xe5minnelse ikke sendt"})})]},e.id))})]})}):(0,n.jsx)("div",{className:"bg-blue-50 p-4 rounded text-blue-800",children:"Ingen e-poster trenger p\xe5minnelse for \xf8yeblikket."})]}),(0,n.jsxs)("div",{className:"mt-12",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Alle sendte e-poster"}),x||0!==e.length?(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Navn"}),(0,n.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"E-post"}),(0,n.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sendt dato"}),(0,n.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"P\xe5minnelse"}),(0,n.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Klikket"}),(0,n.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),(0,n.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.name}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.email}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:c(e.sent_at)}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.reminder_sent_at?(0,n.jsxs)("span",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"mr-2 w-2 h-2 bg-blue-500 rounded-full"}),c(e.reminder_sent_at)]}):(0,n.jsxs)("span",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"mr-2 w-2 h-2 bg-gray-300 rounded-full"}),"Ikke sendt"]})}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.clicked_at?(0,n.jsxs)("span",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"mr-2 w-2 h-2 bg-green-500 rounded-full"}),c(e.clicked_at)]}):(0,n.jsxs)("span",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"mr-2 w-2 h-2 bg-gray-300 rounded-full"}),"Ikke klikket"]})}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.clicked_at?(0,n.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800",children:"Klikket"}):e.reminder_sent_at?(0,n.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:"P\xe5minnelse sendt"}):d(e.sent_at)>=2?(0,n.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800",children:"P\xe5minnelse p\xe5krevd"}):(0,n.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800",children:"Venter"})})]},e.id))})]})}):(0,n.jsx)("div",{className:"bg-blue-50 p-4 rounded text-blue-800",children:"Ingen e-poster er sendt enn\xe5."})]})]})}):(0,n.jsx)("div",{className:"min-h-screen bg-gray-100 p-6",children:(0,n.jsx)("div",{className:"max-w-6xl mx-auto bg-white rounded shadow p-6",children:(0,n.jsxs)("div",{className:"bg-red-100 p-4 rounded mb-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Ikke innlogget"}),(0,n.jsx)("p",{className:"mb-4",children:"Du m\xe5 v\xe6re logget inn for \xe5 se denne siden."}),(0,n.jsx)(i.default,{href:"/login",className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"G\xe5 til innloggingssiden"})]})})})}}},function(e){e.O(0,[714,792,231,971,69,744],function(){return e(e.s=3807)}),_N_E=e.O()}]);