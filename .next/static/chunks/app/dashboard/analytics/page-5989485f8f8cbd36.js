(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[171],{1463:function(e,t,s){Promise.resolve().then(s.bind(s,90884))},90884:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return U}});var r=s(57437),n=s(2265),a=s(58714),l=s(27815),i=s(40110),o=s(40386),d=s(50986),c=s(49231),u=s(41743),m=s(73020),x=s(97256),h=s(18194),f=s(26587),p=s(66363),j=s(38333),g=s(23356),k=s(22983),b=s(10166),v=s(94866),y=s(98061),N=s(81433),w=s(28485),S=s(8792),C=s(90684),K=s(75879),O=s(29733),R=s(26490),_=s(1657);function Z(e){let{requestsSent:t=542,reviewsReceived:s=182,clickRate:n=47.8,remindersSent:a=219,weeklyGrowth:i=34,conversionRate:o=33.6,isAboveAverage:d=!0,newReminders:c=17}=e;return(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[(0,r.jsxs)(l.Zb,{className:"rounded-2xl shadow-md overflow-hidden",children:[(0,r.jsxs)(l.Ol,{className:"pb-2 relative",children:[(0,r.jsx)("div",{className:"absolute top-4 right-4 p-2 bg-blue-100 text-blue-600 rounded-full",children:(0,r.jsx)(C.Z,{className:"h-5 w-5"})}),(0,r.jsx)(l.ll,{className:"text-sm font-medium text-gray-500",children:"Foresp\xf8rsler sendt"})]}),(0,r.jsxs)(l.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:t}),(0,r.jsxs)("p",{className:"text-sm font-medium text-green-600 mt-1",children:["+",i,"% siste uke"]})]})]}),(0,r.jsxs)(l.Zb,{className:"rounded-2xl shadow-md overflow-hidden",children:[(0,r.jsxs)(l.Ol,{className:"pb-2 relative",children:[(0,r.jsx)("div",{className:"absolute top-4 right-4 p-2 bg-yellow-100 text-yellow-600 rounded-full",children:(0,r.jsx)(K.Z,{className:"h-5 w-5"})}),(0,r.jsx)(l.ll,{className:"text-sm font-medium text-gray-500",children:"Anmeldelser mottatt"})]}),(0,r.jsxs)(l.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:s}),(0,r.jsxs)("p",{className:"text-sm font-medium text-gray-600 mt-1",children:["Conversion rate: ",o,"%"]})]})]}),(0,r.jsxs)(l.Zb,{className:"rounded-2xl shadow-md overflow-hidden",children:[(0,r.jsxs)(l.Ol,{className:"pb-2 relative",children:[(0,r.jsx)("div",{className:"absolute top-4 right-4 p-2 bg-green-100 text-green-600 rounded-full",children:(0,r.jsx)(O.Z,{className:"h-5 w-5"})}),(0,r.jsx)(l.ll,{className:"text-sm font-medium text-gray-500",children:"Klikkrate"})]}),(0,r.jsxs)(l.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:"".concat(n.toFixed(1),"%")}),(0,r.jsx)("p",{className:(0,_.cn)("text-sm font-medium mt-1",d?"text-green-600":"text-yellow-600"),children:d?"Over gjennomsnittet":"Under gjennomsnittet"})]})]}),(0,r.jsxs)(l.Zb,{className:"rounded-2xl shadow-md overflow-hidden",children:[(0,r.jsxs)(l.Ol,{className:"pb-2 relative",children:[(0,r.jsx)("div",{className:"absolute top-4 right-4 p-2 bg-purple-100 text-purple-600 rounded-full",children:(0,r.jsx)(R.Z,{className:"h-5 w-5"})}),(0,r.jsx)(l.ll,{className:"text-sm font-medium text-gray-500",children:"P\xe5minnelser sendt"})]}),(0,r.jsxs)(l.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:a}),(0,r.jsxs)("p",{className:"text-sm font-medium text-gray-600 mt-1",children:[c," nye siste 24t"]})]})]})]})}var D=s(17139);function U(){let[e,t]=(0,n.useState)(!0),[s,C]=(0,n.useState)(null),[K,O]=(0,n.useState)([]),[R,_]=(0,n.useState)([]),[U,F]=(0,n.useState)({totalSent:0,totalClicked:0,responseRate:0}),[M,P]=(0,n.useState)("compare"),E=(0,a.createClientComponentClient)();(0,n.useEffect)(()=>{!async function(){t(!0);try{let{data:{session:e},error:t}=await E.auth.getSession();if(t||!e)throw Error("Du m\xe5 v\xe6re innlogget for \xe5 se denne siden");let s=e.user.id,r=new Date,n=(0,d.k)(r,30),{data:a,error:l}=await E.from("sent_emails").select("id, user_id, sent_at, clicked_at").eq("user_id",s).gte("sent_at",n.toISOString()).lte("sent_at",r.toISOString()).order("sent_at",{ascending:!0});if(l)throw l;let i=Y(a||[]);O(i.dailyMetrics),_(i.weeklyMetrics),F(i.overallStats)}catch(e){console.error("Error fetching email data:",e),C(e.message||"En feil oppstod ved henting av e-postdata")}finally{t(!1)}}()},[E]);let Y=e=>{let t=new Map,s=new Map;for(let e=0;e<30;e++){let r=(0,d.k)(new Date,e),n=(0,c.WU)(r,"yyyy-MM-dd");t.set(n,{sentCount:0,clickCount:0});let a=(0,u.z)(r,{weekStartsOn:1}),l=(0,m.Q)(r,{weekStartsOn:1}),i=(0,c.WU)(a,"yyyy-ww");s.has(i)||s.set(i,{weekNumber:l,sentCount:0,clickCount:0})}let r=0,n=0;e.forEach(e=>{let a=(0,x.D)(e.sent_at),l=(0,c.WU)(a,"yyyy-MM-dd"),i=(0,u.z)(a,{weekStartsOn:1});(0,m.Q)(a,{weekStartsOn:1});let o=(0,c.WU)(i,"yyyy-ww");if(t.has(l)){let e=t.get(l);e.sentCount+=1,t.set(l,e)}if(s.has(o)){let e=s.get(o);e.sentCount+=1,s.set(o,e)}if(e.clicked_at){let r=(0,x.D)(e.clicked_at),a=(0,c.WU)(r,"yyyy-MM-dd");if(t.has(a)){let e=t.get(a);e.clickCount+=1,t.set(a,e)}let l=(0,u.z)(r,{weekStartsOn:1}),i=(0,c.WU)(l,"yyyy-ww");if(s.has(i)){let e=s.get(i);e.clickCount+=1,s.set(i,e)}n+=1}r+=1});let a=Array.from(t.entries()).map(e=>{let[t,s]=e;return{date:t,sentCount:s.sentCount,clickCount:s.clickCount}}).sort((e,t)=>e.date.localeCompare(t.date)),l=Array.from(s.entries()).map(e=>{let[t,s]=e;return{week:t,weekNumber:s.weekNumber,sentCount:s.sentCount,clickCount:s.clickCount,responseRate:s.sentCount>0?s.clickCount/s.sentCount*100:0}}).sort((e,t)=>e.week.localeCompare(t.week)),i=r>0?n/r*100:0;return{dailyMetrics:a,weeklyMetrics:l,overallStats:{totalSent:r,totalClicked:n,responseRate:i}}},A=e=>{let t=(0,x.D)(e);return(0,c.WU)(t,"d. MMM",{locale:h.nb})},W=e=>{let[t,s]=e.split("-");return"Uke ".concat(s)};return(0,r.jsx)(o.Z,{children:(0,r.jsx)("div",{className:"min-h-screen bg-gray-100 p-6",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Analysetavle"}),(0,r.jsx)(S.default,{href:"/dashboard",className:"text-blue-600 hover:underline",children:"â† Tilbake til dashboard"})]}),e?(0,r.jsx)("div",{className:"flex justify-center items-center py-20",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):s?(0,r.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:s}):(0,r.jsxs)("div",{className:"space-y-10",children:[(0,r.jsxs)("section",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"N\xf8kkeltall"}),(0,r.jsx)(Z,{requestsSent:U.totalSent,reviewsReceived:Math.round(.33*U.totalSent),clickRate:U.responseRate,remindersSent:Math.round(.4*U.totalSent),weeklyGrowth:15,conversionRate:33.6,isAboveAverage:U.responseRate>40,newReminders:17}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsxs)(l.Zb,{className:"rounded-xl shadow-md overflow-hidden",children:[(0,r.jsxs)(l.Ol,{className:"pb-2 relative",children:[(0,r.jsx)("div",{className:"absolute top-4 right-4 p-2 bg-purple-100 text-purple-600 rounded-full",children:(0,r.jsx)(D.Z,{className:"h-5 w-5"})}),(0,r.jsx)(l.ll,{className:"text-sm font-medium text-gray-500",children:"Svarprosent"})]}),(0,r.jsxs)(l.aY,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold",children:[U.responseRate.toFixed(1),"%"]}),(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600 mt-1",children:"Klikk / Sendte e-poster"})]})]})})]}),(0,r.jsxs)("section",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Trenddata"}),(0,r.jsxs)("div",{className:"flex space-x-2 bg-gray-100 p-1 rounded-lg",children:[(0,r.jsx)("button",{onClick:()=>P("sent"),className:"px-3 py-1.5 text-sm rounded-md transition-colors ".concat("sent"===M?"bg-white shadow-sm":"hover:bg-gray-200"),children:"Sendte"}),(0,r.jsx)("button",{onClick:()=>P("clicked"),className:"px-3 py-1.5 text-sm rounded-md transition-colors ".concat("clicked"===M?"bg-white shadow-sm":"hover:bg-gray-200"),children:"Klikk"}),(0,r.jsx)("button",{onClick:()=>P("compare"),className:"px-3 py-1.5 text-sm rounded-md transition-colors ".concat("compare"===M?"bg-white shadow-sm":"hover:bg-gray-200"),children:"Sammenlign"})]})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 gap-6 mb-6",children:(0,r.jsxs)(l.Zb,{className:"col-span-full",children:[(0,r.jsxs)(l.Ol,{className:"relative",children:[(0,r.jsxs)("div",{className:"absolute top-4 right-4 flex space-x-2",children:[(0,r.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[U.totalSent," sendt"]}),(0,r.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[U.totalClicked," klikk"]})]}),(0,r.jsxs)(l.ll,{children:["sent"===M&&"Sendte e-poster per dag","clicked"===M&&"Klikk per dag","compare"===M&&"Sammenligning: Sendte vs. Klikk"]}),(0,r.jsx)(l.SZ,{children:"Siste 30 dager"})]}),(0,r.jsx)(l.aY,{className:"h-80",children:(0,r.jsx)(f.h,{width:"100%",height:"100%",children:(0,r.jsxs)(p.w,{data:K,margin:{top:5,right:30,left:20,bottom:5},children:[(0,r.jsx)(j.q,{strokeDasharray:"3 3"}),(0,r.jsx)(g.K,{dataKey:"date",tickFormatter:A,tick:{fontSize:12}}),(0,r.jsx)(k.B,{}),(0,r.jsx)(b.u,{formatter:(e,t)=>"sentCount"===t?["".concat(e," e-poster"),"Sendt"]:"clickCount"===t?["".concat(e," klikk"),"Klikk"]:[e,t],labelFormatter:e=>A(e)}),(0,r.jsx)(v.D,{}),("sent"===M||"compare"===M)&&(0,r.jsx)(y.x,{type:"monotone",dataKey:"sentCount",name:"Sendte e-poster",stroke:"#3b82f6",activeDot:{r:8},strokeWidth:2}),("clicked"===M||"compare"===M)&&(0,r.jsx)(y.x,{type:"monotone",dataKey:"clickCount",name:"Klikk",stroke:"#10b981",activeDot:{r:8},strokeWidth:2})]})})})]})}),(0,r.jsxs)(i.mQ,{defaultValue:"daily",className:"w-full",children:[(0,r.jsxs)(i.dr,{className:"grid w-full grid-cols-2",children:[(0,r.jsx)(i.SP,{value:"daily",children:"Daglig oversikt"}),(0,r.jsx)(i.SP,{value:"weekly",children:"Ukentlig oversikt"})]}),(0,r.jsx)(i.nU,{value:"daily",className:"space-y-6 mt-6",children:(0,r.jsxs)(l.Zb,{children:[(0,r.jsxs)(l.Ol,{children:[(0,r.jsx)(l.ll,{children:"Daglig e-poststatistikk"}),(0,r.jsx)(l.SZ,{children:"Detaljert oversikt over daglig e-postaktivitet"})]}),(0,r.jsx)(l.aY,{className:"h-80",children:(0,r.jsx)(f.h,{width:"100%",height:"100%",children:(0,r.jsxs)(N.v,{data:K.slice(-14),margin:{top:5,right:30,left:20,bottom:5},children:[(0,r.jsx)(j.q,{strokeDasharray:"3 3"}),(0,r.jsx)(g.K,{dataKey:"date",tickFormatter:A,tick:{fontSize:12}}),(0,r.jsx)(k.B,{}),(0,r.jsx)(b.u,{formatter:(e,t)=>"sentCount"===t?["".concat(e," e-poster"),"Sendt"]:"clickCount"===t?["".concat(e," klikk"),"Klikk"]:[e,t],labelFormatter:e=>A(e)}),(0,r.jsx)(v.D,{}),(0,r.jsx)(w.$,{dataKey:"sentCount",name:"Sendte e-poster",fill:"#3b82f6"}),(0,r.jsx)(w.$,{dataKey:"clickCount",name:"Klikk",fill:"#10b981"})]})})})]})}),(0,r.jsxs)(i.nU,{value:"weekly",className:"space-y-6 mt-6",children:[(0,r.jsxs)(l.Zb,{children:[(0,r.jsxs)(l.Ol,{children:[(0,r.jsx)(l.ll,{children:"Ukentlig e-postaktivitet"}),(0,r.jsx)(l.SZ,{children:"Sendte e-poster og klikk per uke"})]}),(0,r.jsx)(l.aY,{className:"h-80",children:(0,r.jsx)(f.h,{width:"100%",height:"100%",children:(0,r.jsxs)(N.v,{data:R,margin:{top:5,right:30,left:20,bottom:5},children:[(0,r.jsx)(j.q,{strokeDasharray:"3 3"}),(0,r.jsx)(g.K,{dataKey:"week",tickFormatter:W,tick:{fontSize:12}}),(0,r.jsx)(k.B,{}),(0,r.jsx)(b.u,{formatter:(e,t)=>"responseRate"===t?["".concat(Number(e).toFixed(1),"%"),"Svarprosent"]:[e,"sentCount"===t?"Sendte e-poster":"Klikk"],labelFormatter:e=>W(e)}),(0,r.jsx)(v.D,{}),(0,r.jsx)(w.$,{dataKey:"sentCount",name:"Sendte e-poster",fill:"#3b82f6"}),(0,r.jsx)(w.$,{dataKey:"clickCount",name:"Klikk",fill:"#10b981"})]})})})]}),(0,r.jsxs)(l.Zb,{children:[(0,r.jsxs)(l.Ol,{children:[(0,r.jsx)(l.ll,{children:"Ukentlig svarprosent"}),(0,r.jsx)(l.SZ,{children:"Prosentandel klikk per sendte e-poster per uke"})]}),(0,r.jsx)(l.aY,{className:"h-80",children:(0,r.jsx)(f.h,{width:"100%",height:"100%",children:(0,r.jsxs)(p.w,{data:R,margin:{top:5,right:30,left:20,bottom:5},children:[(0,r.jsx)(j.q,{strokeDasharray:"3 3"}),(0,r.jsx)(g.K,{dataKey:"week",tickFormatter:W,tick:{fontSize:12}}),(0,r.jsx)(k.B,{tickFormatter:e=>"".concat(e,"%")}),(0,r.jsx)(b.u,{formatter:e=>["".concat(Number(e).toFixed(1),"%"),"Svarprosent"],labelFormatter:e=>W(e)}),(0,r.jsx)(v.D,{}),(0,r.jsx)(y.x,{type:"monotone",dataKey:"responseRate",name:"Svarprosent",stroke:"#8b5cf6",activeDot:{r:8},strokeWidth:2})]})})})]})]})]})]})]})]})})})}},40386:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var r=s(57437),n=s(2265),a=s(47907),l=s(45331);function i(e){let{children:t}=e,{session:s,isLoading:i}=(0,l.useAuth)(),o=(0,a.useRouter)();return((0,n.useEffect)(()=>{i||s||o.push("/login")},[i,s,o]),i)?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen pointer-events-none",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):s?(0,r.jsx)(r.Fragment,{children:t}):null}},27815:function(e,t,s){"use strict";s.d(t,{Ol:function(){return i},SZ:function(){return d},Zb:function(){return l},aY:function(){return c},ll:function(){return o}});var r=s(57437),n=s(2265),a=s(1657);let l=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border border-gray-200 bg-white text-gray-950 shadow-sm relative pointer-events-auto",s),...n})});l.displayName="Card";let i=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6 pointer-events-auto",s),...n})});i.displayName="CardHeader";let o=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("h3",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",s),...n})});o.displayName="CardTitle";let d=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("p",{ref:t,className:(0,a.cn)("text-sm text-gray-500",s),...n})});d.displayName="CardDescription";let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0 pointer-events-auto",s),...n})});c.displayName="CardContent",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0 pointer-events-auto",s),...n})}).displayName="CardFooter"},40110:function(e,t,s){"use strict";s.d(t,{SP:function(){return d},dr:function(){return o},mQ:function(){return i},nU:function(){return c}});var r=s(57437),n=s(2265),a=s(52499),l=s(1657);let i=a.fC,o=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(a.aV,{ref:t,className:(0,l.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...n})});o.displayName=a.aV.displayName;let d=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(a.xz,{ref:t,className:(0,l.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...n})});d.displayName=a.xz.displayName;let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(a.VY,{ref:t,className:(0,l.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...n})});c.displayName=a.VY.displayName},45331:function(e,t,s){"use strict";s.r(t),s.d(t,{AuthProvider:function(){return c},useAuth:function(){return d}});var r=s(57437),n=s(2265),a=s(47907),l=s(58714);async function i(e,t){if(!t)return!1;try{let{data:r,error:n}=await e.from("profiles").select("id").eq("id",t.id).single();if(n){if("PGRST116"!==n.code)return console.error("ensureUserProfile: Feil ved henting av profil:",n),!1;{var s;console.log("ensureUserProfile: Oppretter profil for bruker ".concat(t.id));let{error:r}=await e.from("profiles").upsert({id:t.id,email:t.email,full_name:(null===(s=t.user_metadata)||void 0===s?void 0:s.full_name)||"",onboarding_completed:!1,connected_review_platforms:[]},{onConflict:"id"});if(r)return console.error("ensureUserProfile: Feil ved oppretting av profil:",r),!1}}return!0}catch(e){return console.error("ensureUserProfile: Uventet feil:",e),!1}}let o=(0,n.createContext)({session:null,isLoading:!0,signOut:async()=>{}}),d=()=>(0,n.useContext)(o),c=e=>{let{children:t}=e,[s,d]=(0,n.useState)(null),[c,u]=(0,n.useState)(!0),m=(0,a.useRouter)(),x=(0,l.createClientComponentClient)();(0,n.useEffect)(()=>{(async()=>{try{let{data:{session:e}}=await x.auth.getSession();d(e),e&&await i(x,e.user)}catch(e){console.error("Error fetching session:",e)}finally{u(!1)}})();let{data:{subscription:e}}=x.auth.onAuthStateChange(async(e,t)=>{d(t),t&&await i(x,t.user)});return()=>{e.unsubscribe()}},[x.auth]);let h=async()=>{try{await x.auth.signOut(),m.push("/login")}catch(e){console.error("Error signing out:",e)}};return(0,r.jsx)(o.Provider,{value:{session:s,isLoading:c,signOut:h},children:t})}},1657:function(e,t,s){"use strict";s.d(t,{cn:function(){return a}});var r=s(75504),n=s(51367);function a(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,n.m6)((0,r.W)(t))}}},function(e){e.O(0,[714,792,150,231,679,539,971,69,744],function(){return e(e.s=1463)}),_N_E=e.O()}]);