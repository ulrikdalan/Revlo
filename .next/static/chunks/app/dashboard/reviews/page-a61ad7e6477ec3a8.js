(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[696],{55200:function(e,t,r){Promise.resolve().then(r.bind(r,34696))},9429:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m}});var s=r(57437),l=r(2265),a=r(58714),n=r(27815),i=r(50660),o=r(8792),d=r(49231),c=r(18194),u=r(1657);function m(){let[e,t]=(0,l.useState)([]),[r,m]=(0,l.useState)([]),[f,h]=(0,l.useState)(!0),[x,p]=(0,l.useState)(null),b=(0,a.createClientComponentClient)();(0,l.useEffect)(()=>{!async function(){h(!0);try{let{data:{session:e}}=await b.auth.getSession();if(!e)return;let r=e.user.id,{data:s,error:l}=await b.from("platforms").select("*").order("name");l||m(s||[]);let{data:a,error:n}=await b.from("external_reviews").select("*").eq("user_id",r).order("published_at",{ascending:!1}).limit(3);if(n)throw n;t(a||[])}catch(e){console.error("Error fetching recent external reviews:",e),p(e.message)}finally{h(!1)}}()},[b]);let g=e=>(0,d.WU)(new Date(e),"d. MMM yyyy",{locale:c.nb}),v=e=>(0,s.jsx)("div",{className:"flex",children:[1,2,3,4,5].map(t=>(0,s.jsx)("span",{className:(0,u.cn)("text-sm",t<=e?"text-yellow-500":"text-gray-300"),children:"★"},t))}),j=e=>{let t=r.find(t=>t.name.toLowerCase()===e.toLowerCase());if(t)return{color:t.color||"#e5e7eb",initials:t.icon||t.name.substring(0,1).toUpperCase(),displayName:t.display_name||e};switch(e.toLowerCase()){case"google":return{color:"#4285F4",initials:"G",displayName:"Google"};case"trustpilot":return{color:"#00B67A",initials:"TP",displayName:"Trustpilot"};case"facebook":return{color:"#1877F2",initials:"FB",displayName:"Facebook"};default:return{color:"#9CA3AF",initials:e.substring(0,2).toUpperCase(),displayName:e}}};return f?(0,s.jsxs)(n.Zb,{children:[(0,s.jsx)(n.Ol,{children:(0,s.jsx)(n.ll,{className:"text-lg",children:"Nyeste eksterne anmeldelser"})}),(0,s.jsx)(n.aY,{children:(0,s.jsx)("div",{className:"flex justify-center py-4",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"})})})]}):x?(0,s.jsxs)(n.Zb,{children:[(0,s.jsx)(n.Ol,{children:(0,s.jsx)(n.ll,{className:"text-lg",children:"Nyeste eksterne anmeldelser"})}),(0,s.jsx)(n.aY,{children:(0,s.jsx)("div",{className:"text-red-500 text-sm",children:"Kunne ikke laste anmeldelser"})})]}):(0,s.jsxs)(n.Zb,{children:[(0,s.jsx)(n.Ol,{className:"pb-2",children:(0,s.jsx)(n.ll,{className:"text-lg",children:"Nyeste eksterne anmeldelser"})}),(0,s.jsx)(n.aY,{children:0===e.length?(0,s.jsx)("div",{className:"text-center text-gray-500 text-sm py-3",children:"Ingen eksterne anmeldelser funnet"}):(0,s.jsxs)("div",{className:"space-y-4",children:[e.map(e=>{let t=j(e.platform);return(0,s.jsxs)("div",{className:"border-b pb-3 last:border-0",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(i.qE,{className:"h-6 w-6",children:(0,s.jsx)(i.Q5,{style:{backgroundColor:t.color,color:"#ffffff",fontSize:"10px"},children:t.initials})}),(0,s.jsx)("div",{className:"font-semibold text-sm",children:e.author_name})]}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:g(e.published_at)})]}),(0,s.jsxs)("div",{className:"flex items-center mb-1 ml-8",children:[v(e.rating),(0,s.jsx)("span",{className:"ml-2 text-xs text-gray-600 font-medium",children:t.displayName})]}),e.comment&&(0,s.jsx)("p",{className:"text-sm text-gray-700 line-clamp-2 ml-8",children:e.comment})]},e.id)}),(0,s.jsx)("div",{className:"text-center pt-2",children:(0,s.jsx)(o.default,{href:"/dashboard/reviews/external",className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Se alle anmeldelser →"})})]})})]})}},34696:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f},revalidate:function(){return m}});var s=r(57437),l=r(58714),a=r(2265),n=r(8792),i=r(27815),o=r(40386);function d(){let[e,t]=(0,a.useState)(""),[r,l]=(0,a.useState)(""),[n,i]=(0,a.useState)(""),[o,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1),[m,f]=(0,a.useState)([]),[h,x]=(0,a.useState)(""),[p,b]=(0,a.useState)(""),[g,v]=(0,a.useState)(""),[j,y]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{y(!0);try{let e=await fetch("/api/email-templates",{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Kunne ikke hente e-postmaler");let t=await e.json();f(t.templates||[])}catch(e){console.error("Error fetching email templates:",e)}finally{y(!1)}})()},[]);let N=async s=>{s.preventDefault(),d(!0);try{let s=await fetch("/api/send-review-request",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:r,reviewLink:n,subject:p,body:g})});if(!s.ok){let e=await s.json();throw Error(e.error||"Feil ved sending av e-post")}u(!0),t(""),l(""),i(""),x(""),b(""),v("")}catch(e){alert(e.message)}finally{d(!1)}};return(0,s.jsxs)("form",{onSubmit:N,className:"space-y-4 max-w-md mx-auto",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"template",className:"block text-sm font-medium text-gray-700 mb-1",children:"Velg e-postmal (valgfritt)"}),(0,s.jsxs)("select",{id:"template",value:h,onChange:e=>{let t=e.target.value;if(x(t),t){let e=m.find(e=>e.id===t);e&&(b(e.subject),v(e.content))}else b(""),v("")},className:"border px-4 py-2 w-full rounded",disabled:j,children:[(0,s.jsx)("option",{value:"",children:"Velg mal..."}),m.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Navn"}),(0,s.jsx)("input",{id:"name",type:"text",placeholder:"Kundens navn",value:e,onChange:e=>t(e.target.value),className:"border px-4 py-2 w-full rounded",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"E-post"}),(0,s.jsx)("input",{id:"email",type:"email",placeholder:"Kundens e-postadresse",value:r,onChange:e=>l(e.target.value),className:"border px-4 py-2 w-full rounded",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"reviewLink",className:"block text-sm font-medium text-gray-700 mb-1",children:"Anmeldelseslenke"}),(0,s.jsx)("input",{id:"reviewLink",type:"text",placeholder:"https://...",value:n,onChange:e=>i(e.target.value),className:"border px-4 py-2 w-full rounded",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"subject",className:"block text-sm font-medium text-gray-700 mb-1",children:"E-post emne"}),(0,s.jsx)("input",{id:"subject",type:"text",placeholder:"Emne for e-posten",value:p,onChange:e=>b(e.target.value),className:"border px-4 py-2 w-full rounded",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700 mb-1",children:"E-post innhold"}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mb-1",children:["Tips: Bruk ","{{name}}"," for kundens navn og ","{{link}}"," for anmeldelseslenken."]}),(0,s.jsx)("textarea",{id:"content",placeholder:"Innhold for e-posten...",value:g,onChange:e=>v(e.target.value),className:"border px-4 py-2 w-full rounded",rows:6,required:!0})]}),(0,s.jsx)("button",{type:"submit",disabled:o,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors disabled:opacity-50",children:o?"Sender...":"Send vurderingsforesp\xf8rsel"}),c&&(0,s.jsx)("div",{className:"bg-green-100 text-green-700 p-3 rounded",children:"E-post sendt! Kunden vil motta en e-post med anmeldelseslenken."})]})}function c(){let[e,t]=(0,a.useState)(!1),[r,l]=(0,a.useState)(null),n=async()=>{t(!0),l(null);try{let e=await fetch("/api/send-reminders",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await e.json();if(!e.ok)throw Error(t.error||"Feil ved sending av p\xe5minnelser");l({success:!0,message:t.message||"".concat(t.sentCount," p\xe5minnelser ble sendt")})}catch(e){console.error("Error sending reminders:",e),l({success:!1,message:e.message})}finally{t(!1)}};return(0,s.jsxs)("div",{className:"my-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Automatiske p\xe5minnelser"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"Send p\xe5minnelser til kunder som ikke har klikket p\xe5 sin vurderingslenke etter 2 dager."}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("button",{onClick:n,disabled:e,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors flex items-center disabled:opacity-50",children:e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Sender p\xe5minnelser..."]}):"Send p\xe5minnelser"}),r&&(0,s.jsx)("div",{className:"text-sm ".concat(r.success?"text-green-600":"text-red-600"),children:r.message})]})]})}var u=r(9429);let m=0;function f(){let[e,t]=(0,a.useState)(!0),[r,m]=(0,a.useState)(null);return(0,a.useEffect)(()=>{(async function(){let e=(0,l.createClientComponentClient)(),{data:{session:r}}=await e.auth.getSession();r&&r.user&&m(r.user),t(!1)})()},[]),(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-slate-50 p-6",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsxs)(i.Zb,{className:"mb-6 border-0 shadow-lg overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-600 to-indigo-600"}),(0,s.jsx)(i.Ol,{children:(0,s.jsx)(i.ll,{className:"text-2xl font-bold",children:"Anmeldelser"})})]}),(0,s.jsxs)(o.Z,{children:[(0,s.jsxs)("div",{className:"grid gap-6 grid-cols-1 lg:grid-cols-12",children:[(0,s.jsx)("div",{className:"lg:col-span-5",children:(0,s.jsxs)(i.Zb,{className:"h-full border-0 shadow-lg overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-600 to-indigo-600"}),(0,s.jsx)(i.Ol,{children:(0,s.jsx)(i.ll,{children:"Send anmeldelsesforesp\xf8rsel"})}),(0,s.jsx)(i.aY,{className:"p-6",children:(0,s.jsx)(d,{})})]})}),(0,s.jsx)("div",{className:"lg:col-span-7",children:(0,s.jsxs)(i.Zb,{className:"h-full border-0 shadow-lg overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-600 to-indigo-600"}),(0,s.jsxs)(i.Ol,{className:"flex flex-row justify-between items-center pb-2",children:[(0,s.jsx)(i.ll,{children:"Nylige eksterne anmeldelser"}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)(n.default,{href:"/dashboard/sent-reviews",className:"inline-flex items-center justify-center px-4 py-2 rounded-lg text-sm text-blue-700 bg-blue-50 border border-blue-100 font-medium hover:bg-blue-100 transition-colors",children:"Se sendte foresp\xf8rsler"}),(0,s.jsx)(n.default,{href:"/dashboard/reviews/external",className:"inline-flex items-center justify-center px-4 py-2 rounded-lg text-sm text-indigo-700 bg-indigo-50 border border-indigo-100 font-medium hover:bg-indigo-100 transition-colors",children:"Se alle eksterne"})]})]}),(0,s.jsxs)(i.aY,{className:"p-6",children:[(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)(c,{})}),(0,s.jsx)(u.default,{})]})]})})]}),(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsxs)(i.Zb,{className:"border-0 shadow-lg overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-600 to-indigo-600"}),(0,s.jsx)(i.Ol,{children:(0,s.jsx)(i.ll,{children:"Importer eksterne anmeldelser"})}),(0,s.jsx)(i.aY,{className:"p-6",children:(0,s.jsxs)("div",{className:"grid gap-6 grid-cols-1 md:grid-cols-3",children:[(0,s.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-white p-6 rounded-xl border border-blue-100 shadow-md hover:shadow-lg transition-all duration-200 hover:-translate-y-1",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-blue-800 mb-3",children:"Google anmeldelser"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"Importer anmeldelser fra Google My Business for \xe5 f\xe5 en helhetlig oversikt."}),(0,s.jsx)(n.default,{href:"/dashboard/reviews/import/google",className:"inline-flex items-center justify-center px-4 py-2 rounded-lg text-sm text-white bg-gradient-to-r from-blue-600 to-blue-700 font-medium hover:from-blue-700 hover:to-blue-800 transition-colors",children:"Importer fra Google"})]}),(0,s.jsxs)("div",{className:"bg-gradient-to-br from-yellow-50 to-white p-6 rounded-xl border border-yellow-100 shadow-md hover:shadow-lg transition-all duration-200 hover:-translate-y-1",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-yellow-800 mb-3",children:"Tripadvisor anmeldelser"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"Hent inn dine Tripadvisor-anmeldelser for \xe5 f\xe5 en samlet oversikt."}),(0,s.jsx)(n.default,{href:"/dashboard/reviews/import/tripadvisor",className:"inline-flex items-center justify-center px-4 py-2 rounded-lg text-sm text-white bg-gradient-to-r from-yellow-600 to-yellow-700 font-medium hover:from-yellow-700 hover:to-yellow-800 transition-colors",children:"Importer fra Tripadvisor"})]}),(0,s.jsxs)("div",{className:"bg-gradient-to-br from-purple-50 to-white p-6 rounded-xl border border-purple-100 shadow-md hover:shadow-lg transition-all duration-200 hover:-translate-y-1",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-purple-800 mb-3",children:"Facebook anmeldelser"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"Samle dine Facebook-anmeldelser for en komplett oversikt."}),(0,s.jsx)(n.default,{href:"/dashboard/reviews/import/facebook",className:"inline-flex items-center justify-center px-4 py-2 rounded-lg text-sm text-white bg-gradient-to-r from-purple-600 to-purple-700 font-medium hover:from-purple-700 hover:to-purple-800 transition-colors",children:"Importer fra Facebook"})]})]})})]})})]})]})})}},40386:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var s=r(57437),l=r(2265),a=r(47907),n=r(45331);function i(e){let{children:t}=e,{session:r,isLoading:i}=(0,n.useAuth)(),o=(0,a.useRouter)();return((0,l.useEffect)(()=>{i||r||o.push("/login")},[i,r,o]),i)?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen pointer-events-none",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):r?(0,s.jsx)(s.Fragment,{children:t}):null}},50660:function(e,t,r){"use strict";r.d(t,{Q5:function(){return o},qE:function(){return i}});var s=r(57437),l=r(2265),a=r(27733),n=r(1657);let i=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,s.jsx)(a.fC,{ref:t,className:(0,n.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...l})});i.displayName=a.fC.displayName,l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,s.jsx)(a.Ee,{ref:t,className:(0,n.cn)("aspect-square h-full w-full",r),...l})}).displayName=a.Ee.displayName;let o=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,s.jsx)(a.NY,{ref:t,className:(0,n.cn)("flex h-full w-full items-center justify-center rounded-full bg-gray-100 text-gray-700",r),...l})});o.displayName=a.NY.displayName},27815:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},SZ:function(){return d},Zb:function(){return n},aY:function(){return c},ll:function(){return o}});var s=r(57437),l=r(2265),a=r(1657);let n=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border border-gray-200 bg-white text-gray-950 shadow-sm relative pointer-events-auto",r),...l})});n.displayName="Card";let i=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6 pointer-events-auto",r),...l})});i.displayName="CardHeader";let o=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,s.jsx)("h3",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",r),...l})});o.displayName="CardTitle";let d=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,s.jsx)("p",{ref:t,className:(0,a.cn)("text-sm text-gray-500",r),...l})});d.displayName="CardDescription";let c=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0 pointer-events-auto",r),...l})});c.displayName="CardContent",l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0 pointer-events-auto",r),...l})}).displayName="CardFooter"},45331:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return c},useAuth:function(){return d}});var s=r(57437),l=r(2265),a=r(47907),n=r(58714);async function i(e,t){if(!t)return!1;try{let{data:s,error:l}=await e.from("profiles").select("id").eq("id",t.id).single();if(l){if("PGRST116"!==l.code)return console.error("ensureUserProfile: Feil ved henting av profil:",l),!1;{var r;console.log("ensureUserProfile: Oppretter profil for bruker ".concat(t.id));let{error:s}=await e.from("profiles").upsert({id:t.id,email:t.email,full_name:(null===(r=t.user_metadata)||void 0===r?void 0:r.full_name)||"",onboarding_completed:!1,connected_review_platforms:[]},{onConflict:"id"});if(s)return console.error("ensureUserProfile: Feil ved oppretting av profil:",s),!1}}return!0}catch(e){return console.error("ensureUserProfile: Uventet feil:",e),!1}}let o=(0,l.createContext)({session:null,isLoading:!0,signOut:async()=>{}}),d=()=>(0,l.useContext)(o),c=e=>{let{children:t}=e,[r,d]=(0,l.useState)(null),[c,u]=(0,l.useState)(!0),m=(0,a.useRouter)(),f=(0,n.createClientComponentClient)();(0,l.useEffect)(()=>{(async()=>{try{let{data:{session:e}}=await f.auth.getSession();d(e),e&&await i(f,e.user)}catch(e){console.error("Error fetching session:",e)}finally{u(!1)}})();let{data:{subscription:e}}=f.auth.onAuthStateChange(async(e,t)=>{d(t),t&&await i(f,t.user)});return()=>{e.unsubscribe()}},[f.auth]);let h=async()=>{try{await f.auth.signOut(),m.push("/login")}catch(e){console.error("Error signing out:",e)}};return(0,s.jsx)(o.Provider,{value:{session:r,isLoading:c,signOut:h},children:t})}},1657:function(e,t,r){"use strict";r.d(t,{cn:function(){return a}});var s=r(75504),l=r(51367);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,l.m6)((0,s.W)(t))}},47907:function(e,t,r){"use strict";var s=r(15313);r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[714,792,150,231,7,971,69,744],function(){return e(e.s=55200)}),_N_E=e.O()}]);