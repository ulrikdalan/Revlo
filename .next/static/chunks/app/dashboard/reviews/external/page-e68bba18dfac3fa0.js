(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[837],{85102:function(e,t,r){Promise.resolve().then(r.bind(r,59283))},59283:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return b}});var n=r(57437),s=r(2265),a=r(58714),l=r(27815),i=r(50660),o=r(40110),c=r(1657),d=r(49231),u=r(18194),f=r(47907),m=r(40386),p=r(47788),h=r(80037),g=r(52235),x=r(49079);function b(){let[e,t]=(0,s.useState)([]),[r,b]=(0,s.useState)([]),[v,j]=(0,s.useState)(!0),[N,y]=(0,s.useState)(null),k=(0,a.createClientComponentClient)();(0,f.useRouter)();let{toast:w}=(0,p.p)(),_=e=>{let t=[{platform:"google",data:[{author:"Maria G.",rating:5,content:"Kjempegod opplevelse og rask respons! Jeg var veldig forn\xf8yd med tjenesten.",published_at:"2024-03-15"},{author:"Johan L.",rating:4,content:"God service og hyggelige ansatte. Kunne v\xe6rt litt raskere, men ellers bra.",published_at:"2024-04-02"},{author:"Erik M.",rating:5,content:"Utmerket kundeservice! Rask og effektiv hjelp. Vil absolutt anbefale til andre.",published_at:"2024-05-15"}]},{platform:"trustpilot",data:[{author:"Kari N.",rating:5,content:"Fantastisk service! L\xf8ste problemet mitt p\xe5 under en time. Anbefales!",published_at:"2024-03-20"},{author:"Per S.",rating:3,content:"Greit nok. Fikk hjelp til slutt, men m\xe5tte vente litt for lenge.",published_at:"2024-04-05"},{author:"Lise B.",rating:4,content:"God erfaring. Profesjonell h\xe5ndtering og grundig arbeid, men litt dyr pris.",published_at:"2024-04-20"}]},{platform:"yelp",data:[{author:"Erik L.",rating:4,content:"Flinke folk – kunne v\xe6rt raskere, men god kvalitet p\xe5 arbeidet.",published_at:"2024-04-01"},{author:"Ida T.",rating:5,content:"Str\xe5lende kundeservice! Rask respons og profesjonell h\xe5ndtering.",published_at:"2024-03-25"},{author:"Anders J.",rating:4,content:"Solid h\xe5ndverk og bra kundekommunikasjon. Anbefales!",published_at:"2024-05-05"}]},{platform:"facebook",data:[{author:"Petter O.",rating:4,content:"Hyggelig betjening og god kvalitet. Anbefales!",published_at:"2024-03-28"},{author:"Silje M.",rating:5,content:"Fantastisk opplevelse fra start til slutt! Kommer definitivt tilbake.",published_at:"2024-04-10"},{author:"Thomas H.",rating:5,content:"Suveren service og profesjonell h\xe5ndtering. Virkelig forn\xf8yd!",published_at:"2024-05-01"}]}],r=[];return e.forEach(e=>{let n=t.find(t=>t.platform===e);n&&n.data.forEach((t,n)=>{r.push({id:"".concat(e,"-dummy-").concat(n),platform:e,author:t.author,rating:t.rating,content:t.content,published_at:t.published_at})})}),r};(0,s.useEffect)(()=>{!async function(){j(!0),y(null);try{let{data:{session:e},error:r}=await k.auth.getSession();if(r||!e)return;let n=e.user.id,{data:s,error:a}=await k.from("profiles").select("connected_review_platforms").eq("id",n).single();if(a)throw a;let l=(null==s?void 0:s.connected_review_platforms)||[],i=[{name:"google",isConnected:l.includes("google")},{name:"trustpilot",isConnected:l.includes("trustpilot")},{name:"yelp",isConnected:l.includes("yelp")},{name:"facebook",isConnected:l.includes("facebook")}];if(b(i),"true"!==x.env.NEXT_PUBLIC_ENABLE_DUMMY_DATA){let{data:e,error:r}=await k.from("external_reviews").select("*").eq("user_id",n).order("published_at",{ascending:!1});r&&console.error("Error fetching external reviews:",r);let s=(e||[]).map(e=>({id:e.id,platform:e.platform,author:e.author_name,rating:e.rating,content:e.comment,published_at:e.published_at}));t(s.length>0?s:[])}else t(_(l))}catch(e){console.error("Error fetching external reviews:",e),y(e.message||"En feil oppstod ved henting av eksterne anmeldelser")}finally{j(!1)}}()},[k,!1]);let C=e=>(0,d.WU)(new Date(e),"PPP",{locale:u.nb}),E=e=>(0,n.jsx)("div",{className:"flex",children:[1,2,3,4,5].map(t=>(0,n.jsx)("span",{className:(0,c.cn)("text-lg",t<=e?"text-yellow-500":"text-gray-300"),children:"★"},t))}),S=e=>{switch(e.toLowerCase()){case"google":return{color:"#4285F4",initials:"G",displayName:"Google"};case"trustpilot":return{color:"#00B67A",initials:"TP",displayName:"Trustpilot"};case"facebook":return{color:"#1877F2",initials:"FB",displayName:"Facebook"};case"yelp":return{color:"#D32323",initials:"Y",displayName:"Yelp"};default:return{color:"#9CA3AF",initials:e.substring(0,2).toUpperCase(),displayName:e}}},A=()=>{let t=e.map(e=>e.platform);return["all",...Array.from(new Set(t))]},P=e=>{let t=S(e.platform);return(0,n.jsxs)(l.Zb,{className:"h-full flex flex-col",children:[(0,n.jsx)(l.Ol,{className:"pb-2",children:(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)(i.qE,{children:(0,n.jsx)(i.Q5,{style:{backgroundColor:t.color,color:"#ffffff"},children:t.initials})}),(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)(l.ll,{className:"text-lg",children:e.author}),E(e.rating)]})]})}),(0,n.jsxs)(l.aY,{className:"flex-grow",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2 text-sm text-gray-500",children:[(0,n.jsx)("span",{className:"font-medium",children:t.displayName}),(0,n.jsx)("span",{children:C(e.published_at)})]}),(0,n.jsx)("p",{className:"text-gray-700",children:e.content||"Ingen kommentar"})]})]},e.id)},R=()=>(0,n.jsxs)(l.Zb,{className:"mb-8",children:[(0,n.jsx)(l.Ol,{children:(0,n.jsx)(l.ll,{className:"text-xl",children:"Tilkoblede plattformer"})}),(0,n.jsx)(l.aY,{children:(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:r.map(e=>{let t=S(e.name);return(0,n.jsx)(l.Zb,{className:(0,c.cn)("border",e.isConnected?"border-green-200":"border-gray-200"),children:(0,n.jsxs)(l.aY,{className:"flex items-center p-4",children:[(0,n.jsx)(i.qE,{className:"mr-3",children:(0,n.jsx)(i.Q5,{style:{backgroundColor:t.color,color:"#ffffff"},children:t.initials})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-medium",children:t.displayName}),(0,n.jsx)("div",{className:"flex items-center mt-1",children:e.isConnected?(0,n.jsxs)("div",{className:"flex items-center text-green-600",children:[(0,n.jsx)(h.Z,{className:"h-4 w-4 mr-1"}),(0,n.jsx)("span",{className:"text-sm",children:"Tilkoblet"})]}):(0,n.jsxs)("div",{className:"flex items-center text-gray-400",children:[(0,n.jsx)(g.Z,{className:"h-4 w-4 mr-1"}),(0,n.jsx)("span",{className:"text-sm",children:"Ikke tilkoblet"})]})})]})]})},e.name)})})})]});return(0,n.jsx)(m.Z,{children:(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold",children:"Eksterne anmeldelser"}),!1]}),(()=>{if(v)return(0,n.jsx)("div",{className:"flex justify-center items-center py-20",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})});if(N)return(0,n.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:N});let t=R();if(0===e.length){let e=r.filter(e=>e.isConnected).length;return(0,n.jsxs)(n.Fragment,{children:[t,(0,n.jsx)(l.Zb,{children:(0,n.jsx)(l.aY,{className:"py-6",children:(0,n.jsx)("div",{className:"text-center text-gray-500",children:e>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"mb-4",children:"Du har ingen eksterne anmeldelser enn\xe5."}),(0,n.jsx)("p",{className:"text-sm",children:"Eksterne anmeldelser fra dine tilkoblede plattformer vil vises her n\xe5r de er tilgjengelige."})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"mb-4",children:"Du har ikke koblet til noen eksterne plattformer enn\xe5."}),(0,n.jsx)("p",{className:"text-sm",children:"Koble til plattformer i innstillingene for \xe5 samle anmeldelser fra Google, Trustpilot og andre tjenester."})]})})})})]})}let s=A();return(0,n.jsxs)(n.Fragment,{children:[t,(0,n.jsxs)(o.mQ,{defaultValue:"all",className:"w-full",children:[(0,n.jsx)(o.dr,{className:"mb-6",children:s.map(e=>(0,n.jsx)(o.SP,{value:e,children:"all"===e?"Alle":S(e).displayName},e))}),s.map(t=>(0,n.jsx)(o.nU,{value:t,children:(0,n.jsx)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:"all"===t?e.map(e=>P(e)):e.filter(e=>e.platform===t).map(e=>P(e))})},t))]})]})})()]})})}},40386:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(57437),s=r(2265),a=r(47907),l=r(45331);function i(e){let{children:t}=e,{session:r,isLoading:i}=(0,l.useAuth)(),o=(0,a.useRouter)();return((0,s.useEffect)(()=>{i||r||o.push("/login")},[i,r,o]),i)?(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen pointer-events-none",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):r?(0,n.jsx)(n.Fragment,{children:t}):null}},50660:function(e,t,r){"use strict";r.d(t,{Q5:function(){return o},qE:function(){return i}});var n=r(57437),s=r(2265),a=r(27733),l=r(1657);let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(a.fC,{ref:t,className:(0,l.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...s})});i.displayName=a.fC.displayName,s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(a.Ee,{ref:t,className:(0,l.cn)("aspect-square h-full w-full",r),...s})}).displayName=a.Ee.displayName;let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(a.NY,{ref:t,className:(0,l.cn)("flex h-full w-full items-center justify-center rounded-full bg-gray-100 text-gray-700",r),...s})});o.displayName=a.NY.displayName},27815:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return l},aY:function(){return d},ll:function(){return o}});var n=r(57437),s=r(2265),a=r(1657);let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border border-gray-200 bg-white text-gray-950 shadow-sm relative pointer-events-auto",r),...s})});l.displayName="Card";let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6 pointer-events-auto",r),...s})});i.displayName="CardHeader";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("h3",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});o.displayName="CardTitle";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("p",{ref:t,className:(0,a.cn)("text-sm text-gray-500",r),...s})});c.displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0 pointer-events-auto",r),...s})});d.displayName="CardContent",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0 pointer-events-auto",r),...s})}).displayName="CardFooter"},40110:function(e,t,r){"use strict";r.d(t,{SP:function(){return c},dr:function(){return o},mQ:function(){return i},nU:function(){return d}});var n=r(57437),s=r(2265),a=r(52499),l=r(1657);let i=a.fC,o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(a.aV,{ref:t,className:(0,l.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...s})});o.displayName=a.aV.displayName;let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(a.xz,{ref:t,className:(0,l.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...s})});c.displayName=a.xz.displayName;let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(a.VY,{ref:t,className:(0,l.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...s})});d.displayName=a.VY.displayName},47788:function(e,t,r){"use strict";r.d(t,{p:function(){return l}});var n=r(2265);let s=0,a=n.createContext({toasts:[],addToast:()=>{},updateToast:()=>{},dismissToast:()=>{},removeToast:()=>{}}),l=()=>{let{toasts:e,addToast:t,updateToast:r,dismissToast:l,removeToast:i}=n.useContext(a);return{toasts:e,toast:e=>{let n=(s=(s+1)%Number.MAX_VALUE).toString();return t({...e,id:n,open:!0}),{id:n,update:e=>r({...e,id:n}),dismiss:()=>l(n)}},dismiss:e=>l(e)}}},45331:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return d},useAuth:function(){return c}});var n=r(57437),s=r(2265),a=r(47907),l=r(58714);async function i(e,t){if(!t)return!1;try{let{data:n,error:s}=await e.from("profiles").select("id").eq("id",t.id).single();if(s){if("PGRST116"!==s.code)return console.error("ensureUserProfile: Feil ved henting av profil:",s),!1;{var r;console.log("ensureUserProfile: Oppretter profil for bruker ".concat(t.id));let{error:n}=await e.from("profiles").upsert({id:t.id,email:t.email,full_name:(null===(r=t.user_metadata)||void 0===r?void 0:r.full_name)||"",onboarding_completed:!1,connected_review_platforms:[]},{onConflict:"id"});if(n)return console.error("ensureUserProfile: Feil ved oppretting av profil:",n),!1}}return!0}catch(e){return console.error("ensureUserProfile: Uventet feil:",e),!1}}let o=(0,s.createContext)({session:null,isLoading:!0,signOut:async()=>{}}),c=()=>(0,s.useContext)(o),d=e=>{let{children:t}=e,[r,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(!0),f=(0,a.useRouter)(),m=(0,l.createClientComponentClient)();(0,s.useEffect)(()=>{(async()=>{try{let{data:{session:e}}=await m.auth.getSession();c(e),e&&await i(m,e.user)}catch(e){console.error("Error fetching session:",e)}finally{u(!1)}})();let{data:{subscription:e}}=m.auth.onAuthStateChange(async(e,t)=>{c(t),t&&await i(m,t.user)});return()=>{e.unsubscribe()}},[m.auth]);let p=async()=>{try{await m.auth.signOut(),f.push("/login")}catch(e){console.error("Error signing out:",e)}};return(0,n.jsx)(o.Provider,{value:{session:r,isLoading:d,signOut:p},children:t})}},1657:function(e,t,r){"use strict";r.d(t,{cn:function(){return a}});var n=r(75504),s=r(51367);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,n.W)(t))}}},function(e){e.O(0,[714,150,231,7,679,195,971,69,744],function(){return e(e.s=85102)}),_N_E=e.O()}]);