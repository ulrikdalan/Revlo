(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[123],{57020:function(e,t,s){Promise.resolve().then(s.bind(s,43858))},43858:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var r=s(57437),a=s(2265),n=s(8792),l=s(58714),i=s(49231);function d(e){let{onSuccess:t,initialData:s={name:"",subject:"",body:""},mode:n="create"}=e,[l,i]=(0,a.useState)(s.name),[d,c]=(0,a.useState)(s.subject),[o,m]=(0,a.useState)(s.body),[x,u]=(0,a.useState)(!1),[h,p]=(0,a.useState)(null),[g,b]=(0,a.useState)(!1),f=async e=>{e.preventDefault(),u(!0),p(null),b(!1);try{let e=await fetch("/api/templates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:l,subject:d,body:o})}),s=await e.json();if(!e.ok)throw Error(s.error||"Noe gikk galt ved lagring av malen");b(!0),"create"===n&&(i(""),c(""),m("")),t&&t()}catch(e){console.error("Error saving template:",e),p(e.message)}finally{u(!1)}};return(0,r.jsxs)("form",{onSubmit:f,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Malnavn"}),(0,r.jsx)("input",{id:"name",type:"text",value:l,onChange:e=>i(e.target.value),className:"w-full border rounded p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"F.eks. Standard vurderingsforesp\xf8rsel",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"subject",className:"block text-sm font-medium text-gray-700 mb-1",children:"E-post emne"}),(0,r.jsx)("input",{id:"subject",type:"text",value:d,onChange:e=>c(e.target.value),className:"w-full border rounded p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"F.eks. Vi \xf8nsker din tilbakemelding!",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"body",className:"block text-sm font-medium text-gray-700 mb-1",children:"E-post innhold"}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mb-2",children:["Du kan bruke ","{","{","'name'","}","}}"," som variabel for kundens navn og ","{","{","'link'","}","}}"," for vurderingslenken."]}),(0,r.jsx)("textarea",{id:"body",value:o,onChange:e=>m(e.target.value),rows:8,className:"w-full border rounded p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"F.eks. Hei {{name}}, vi setter pris p\xe5 om du kan gi oss en vurdering. Klikk her: {{link}}",required:!0})]}),h&&(0,r.jsx)("div",{className:"bg-red-100 text-red-700 p-3 rounded",children:h}),g&&(0,r.jsx)("div",{className:"bg-green-100 text-green-700 p-3 rounded",children:"Malen ble lagret!"}),(0,r.jsx)("button",{type:"submit",disabled:x,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50",children:x?"Lagrer...":"create"===n?"Opprett mal":"Oppdater mal"})]})}function c(){let[e,t]=(0,a.useState)([]),[s,c]=(0,a.useState)(!0),[o,m]=(0,a.useState)(null),[x,u]=(0,a.useState)(!1),[h,p]=(0,a.useState)(!1),[g,b]=(0,a.useState)(!1),[f,y]=(0,a.useState)(null),j=async()=>{c(!0),m(null);try{let e=await fetch("/api/templates",{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Kunne ikke hente maler");let s=await e.json();t(s.templates||[])}catch(e){console.error("Error fetching templates:",e),m(e.message||"Feil ved henting av maler")}finally{c(!1)}},v=async e=>{if(confirm("Er du sikker p\xe5 at du vil slette denne malen?"))try{if(!(await fetch("/api/templates?id=".concat(e),{method:"DELETE"})).ok)throw Error("Kunne ikke slette malen");j()}catch(e){console.error("Error deleting template:",e),alert(e.message||"Feil ved sletting av mal")}},N=async()=>{try{let e=(0,l.createClientComponentClient)(),{data:{session:t}}=await e.auth.getSession();if(!t){u(!1);return}u(!0)}catch(e){console.error("Error checking auth:",e),u(!1)}};(0,a.useEffect)(()=>{N()},[]),(0,a.useEffect)(()=>{x&&j()},[x]);let k=e=>{y(e),b(!0)},w=()=>{b(!1),y(null)};return x?(0,r.jsx)("div",{className:"min-h-screen bg-gray-100 p-6",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto bg-white rounded shadow p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"E-postmaler"}),(0,r.jsx)("button",{onClick:()=>{p(!h)},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors",children:h?"Skjul skjema":"Opprett ny mal"})]}),h&&(0,r.jsxs)("div",{className:"mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Opprett ny e-postmal"}),(0,r.jsx)(d,{onSuccess:()=>{j(),p(!1)}})]}),s&&(0,r.jsxs)("div",{className:"bg-gray-100 p-4 rounded text-gray-700 flex items-center justify-center",children:[(0,r.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Laster inn..."]}),o&&(0,r.jsxs)("div",{className:"bg-red-100 text-red-700 p-4 rounded mb-6",children:["Feil ved henting av data: ",o]}),s||0!==e.length?(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Malnavn"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Emne"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Opprettet"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Handlinger"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.name}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.subject}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,i.WU)(new Date(e.created_at),"dd.MM.yyyy HH:mm")}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 space-x-2",children:[(0,r.jsx)("button",{onClick:()=>k(e),className:"text-blue-600 hover:text-blue-800",children:"Forh\xe5ndsvis"}),(0,r.jsx)("button",{onClick:()=>v(e.id),className:"text-red-600 hover:text-red-800 ml-4",children:"Slett"})]})]},e.id))})]})}):(0,r.jsx)("div",{className:"bg-blue-50 p-4 rounded text-blue-800",children:'Ingen maler er opprettet enn\xe5. Opprett din f\xf8rste mal ved \xe5 klikke p\xe5 "Opprett ny mal".'}),g&&f&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[80vh] overflow-auto p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,r.jsx)("h2",{className:"text-xl font-bold",children:f.name}),(0,r.jsx)("button",{onClick:w,className:"text-gray-500 hover:text-gray-700",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsxs)("div",{className:"border rounded-lg p-4 mb-4",children:[(0,r.jsx)("div",{className:"mb-2 text-sm text-gray-500",children:"Emne:"}),(0,r.jsx)("div",{className:"text-gray-800 mb-4",children:f.subject}),(0,r.jsx)("div",{className:"mb-2 text-sm text-gray-500",children:"Innhold:"}),(0,r.jsx)("div",{className:"text-gray-800 whitespace-pre-wrap bg-gray-50 p-4 rounded",children:f.body})]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 mb-4",children:[(0,r.jsx)("div",{children:"Variabler i malen vil bli erstattet n\xe5r e-posten sendes:"}),(0,r.jsxs)("div",{className:"mt-1",children:["- ","{{name}}"," vil bli erstattet med kundens navn"]}),(0,r.jsxs)("div",{children:["- ","{{link}}"," vil bli erstattet med vurderingslenken"]})]}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)("button",{onClick:w,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",children:"Lukk"})})]})})]})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-100 p-6",children:(0,r.jsx)("div",{className:"max-w-6xl mx-auto bg-white rounded shadow p-6",children:(0,r.jsxs)("div",{className:"bg-red-100 p-4 rounded mb-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Ikke innlogget"}),(0,r.jsx)("p",{className:"mb-4",children:"Du m\xe5 v\xe6re logget inn for \xe5 se denne siden."}),(0,r.jsx)(n.default,{href:"/login",className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"G\xe5 til innloggingssiden"})]})})})}}},function(e){e.O(0,[714,792,231,971,69,744],function(){return e(e.s=57020)}),_N_E=e.O()}]);