"use strict";(()=>{var e={};e.id=4701,e.ids=[4701],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},71343:(e,r,t)=>{let s,o;t.r(r),t.d(r,{headerHooks:()=>E,originalPathname:()=>y,patchFetch:()=>b,requestAsyncStorage:()=>m,routeModule:()=>h,serverHooks:()=>q,staticGenerationAsyncStorage:()=>k,staticGenerationBailout:()=>R});var n={};t.r(n),t.d(n,{POST:()=>f});var i=t(95419),a=t(69108),p=t(99678),l=t(98984),u=t(68140),d=t(86323);let c=require("node:crypto");var g=t(7439),x=t(57699);let v=(0,d.eI)("https://rfexljxsabsbfbszzvjf.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{persistSession:!1}});async function f(e){let{email:r,name:t,reviewLink:n,subject:i,body:a}=await e.json();if(!r||!t||!n)return l.NextResponse.json({error:"E-post, navn og anmeldelseslenke er p\xe5krevd"},{status:400});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r))return l.NextResponse.json({error:"Ugyldig e-postformat"},{status:400});if(!process.env.BASE_URL)return l.NextResponse.json({error:"BASE_URL er ikke definert i milj\xf8variablene. Vennligst sett BASE_URL i .env.local"},{status:500});let p=function(){let e=(0,g.cookies)();return(0,x.createRouteHandlerClient)({cookies:()=>e})}(),{data:{session:d},error:f}=await p.auth.getSession();if(f||!d||!d.user)return console.error("Authentication error:",f||"No active session"),l.NextResponse.json({error:"Du m\xe5 v\xe6re logget inn for \xe5 utf\xf8re denne handlingen"},{status:401});let h=d.user.id;try{let e=function(e=21){var r;r=e|=0,!s||s.length<r?(s=Buffer.allocUnsafe(128*r),c.webcrypto.getRandomValues(s),o=0):o+r>s.length&&(c.webcrypto.getRandomValues(s),o=0),o+=r;let t="";for(let r=o-e;r<o;r++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&s[r]];return t}(10),{data:p,error:d}=await v.from("sent_emails").insert([{name:t,email:r,review_link:n,status:"SENT",sent_at:new Date().toISOString(),token:e,user_id:h}]).select().single();if(d)return console.error("Error saving email record:",d),l.NextResponse.json({error:"Feil ved lagring av e-post: "+d.message},{status:500});let g=p?.id;if(!g)throw Error("Kunne ikke hente ID for den lagrede e-posten");let x=process.env.BASE_URL||"http://localhost:3000",f=`${x}/api/track-click?token=${e}`,m=a||`
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; border: 1px solid #e0e0e0; border-radius: 8px;">
        <h2 style="color: #333; margin-bottom: 20px;">Hei {{name}}!</h2>
        <p style="color: #555; font-size: 16px; line-height: 1.5;">Takk for at du valgte oss! Vi setter stor pris p\xe5 om du kan gi oss en vurdering.</p>
        <p style="color: #555; font-size: 16px; line-height: 1.5;">Det tar bare 30 sekunder og betyr mye for oss:</p>
        <div style="text-align: center; margin: 30px 0;">
          <a href="{{link}}" style="background-color: #4CAF50; color: white; padding: 12px 25px; text-decoration: none; border-radius: 4px; font-weight: bold; font-size: 16px; display: inline-block;">Gi din vurdering</a>
        </div>
        <p style="color: #555; font-size: 16px; line-height: 1.5;">Tusen takk for din hjelp!</p>
        <p style="color: #555; font-size: 16px; line-height: 1.5;">Med vennlig hilsen,<br>${process.env.EMAIL_FROM_NAME}</p>
      </div>
    `;m=m.replace(/{{name}}/g,t).replace(/{{link}}/g,f);let k=`
Hei ${t}!

Takk for at du valgte oss! Vi setter stor pris p\xe5 om du kan gi oss en vurdering.
Det tar bare 30 sekunder og betyr mye for oss.

Du kan gi din vurdering her: ${f}

Tusen takk for din hjelp!

Med vennlig hilsen,
${process.env.EMAIL_FROM_NAME}
    `,q=u.createTransport({host:process.env.EMAIL_SERVER,port:Number(process.env.EMAIL_PORT),secure:!1,auth:{user:process.env.EMAIL_USERNAME,pass:process.env.EMAIL_PASSWORD}});return await q.sendMail({from:process.env.EMAIL_FROM,to:r,subject:i||"Vi setter pris p\xe5 din tilbakemelding! \uD83C\uDF1F",html:m,text:k}),l.NextResponse.json({status:"sent",id:g})}catch(e){return console.error("Error sending review request:",e),l.NextResponse.json({error:"Feil ved sending av vurderingsforesp\xf8rsel: "+e.message},{status:500})}}let h=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/send-review-request/route",pathname:"/api/send-review-request",filename:"route",bundlePath:"app/api/send-review-request/route"},resolvedPagePath:"/Users/ulrikdalanfjellstad/Desktop/Revlo/app/api/send-review-request/route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:k,serverHooks:q,headerHooks:E,staticGenerationBailout:R}=h,y="/api/send-review-request/route";function b(){return(0,p.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:k})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1638,5665,2791,3421,5976],()=>t(71343));module.exports=s})();