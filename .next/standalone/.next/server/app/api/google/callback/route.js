"use strict";(()=>{var e={};e.id=9028,e.ids=[9028],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},19822:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>v,originalPathname:()=>b,patchFetch:()=>E,requestAsyncStorage:()=>_,routeModule:()=>m,serverHooks:()=>y,staticGenerationAsyncStorage:()=>k,staticGenerationBailout:()=>x});var o={};t.r(o),t.d(o,{GET:()=>d,dynamic:()=>h});var n=t(95419),s=t(69108),a=t(99678),i=t(98984),c=t(57699),l=t(86323),u=t(7439);async function d(e){try{let r=e.nextUrl.searchParams,t=r.get("code"),o=r.get("state"),n=r.get("error");if(n)return console.error("Google OAuth error:",n),f(`Feil fra Google: ${n}`);if(!t||!o)return console.error("Missing code or state parameter"),f("Manglende p\xe5krevde parametere");let s=(0,u.cookies)(),a=s.get("google-oauth-state")?.value;if(!a||a!==o)return console.error("State parameter mismatch",{storedState:a,state:o}),f("Ugyldig tilstandsparameter");let d=(0,c.createRouteHandlerClient)({cookies:u.cookies}),{data:{session:h},error:m}=await d.auth.getSession();if(m||!h)return console.error("Authentication error:",m||"No active session"),f("Du m\xe5 v\xe6re logget inn");let _=process.env.GOOGLE_CLIENT_ID,k=process.env.GOOGLE_CLIENT_SECRET,y=process.env.GOOGLE_REDIRECT_URI;if(!_||!k||!y)return console.error("Missing OAuth configuration"),f("Google OAuth er ikke konfigurert p\xe5 serveren");let v=await p(t,_,k,y);if(!v.access_token||!v.refresh_token)return console.error("Failed to get tokens:",v.error||"Unknown error"),f(v.error_description||"Kunne ikke hente tokens fra Google");let x=await g(v.access_token);if(!x.locations||0===x.locations.length)return console.error("No business locations found:",x.error||"Unknown error"),f("Ingen virksomhetssteder funnet, sjekk at din Google-konto har en virksomhet koblet til");let b=x.locations[0].locationKey.placeId,E=x.locations[0].name,S=(0,l.eI)("https://rfexljxsabsbfbszzvjf.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{persistSession:!1}}),{error:j}=await S.from("google_accounts").upsert({user_id:h.user.id,access_token:v.access_token,refresh_token:v.refresh_token,place_id:b});if(j)return console.error("Error storing Google account:",j),f(`Feil ved lagring av Google-konto: ${j.message}`);let w=new URL("/dashboard/google-account",e.url);return w.searchParams.set("success","true"),w.searchParams.set("place_name",E),new i.NextResponse(null,{status:302,headers:{Location:w.toString(),"Set-Cookie":"google-oauth-state=; Path=/; HttpOnly; SameSite=Lax; Max-Age=0"}})}catch(e){return console.error("Error processing Google callback:",e),f(`En uventet feil oppstod: ${e.message}`)}}async function p(e,r,t,o){try{let n=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({code:e,client_id:r,client_secret:t,redirect_uri:o,grant_type:"authorization_code"})});return await n.json()}catch(e){return console.error("Error exchanging code for tokens:",e),{access_token:"",refresh_token:"",expires_in:0,token_type:"",error:"exchange_failed",error_description:e.message}}}async function g(e){try{let r=await fetch("https://mybusinessbusinessinformation.googleapis.com/v1/accounts/-/locations",{headers:{Authorization:`Bearer ${e}`}});return await r.json()}catch(e){return console.error("Error getting business location:",e),{error:{message:e.message,status:"UNKNOWN"}}}}function f(e){let r=new URL(`${process.env.BASE_URL}/dashboard/google-account`);return r.searchParams.set("error",e),i.NextResponse.redirect(r)}let h="force-dynamic",m=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/google/callback/route",pathname:"/api/google/callback",filename:"route",bundlePath:"app/api/google/callback/route"},resolvedPagePath:"/Users/ulrikdalanfjellstad/Desktop/Revlo/app/api/google/callback/route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:_,staticGenerationAsyncStorage:k,serverHooks:y,headerHooks:v,staticGenerationBailout:x}=m,b="/api/google/callback/route";function E(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:k})}},48096:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),function(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}(r,{DynamicServerError:function(){return o},isDynamicServerError:function(){return n}});let t="DYNAMIC_SERVER_USAGE";class o extends Error{constructor(e){super("Dynamic server usage: "+e),this.description=e,this.digest=t}}function n(e){return"object"==typeof e&&null!==e&&"digest"in e&&"string"==typeof e.digest&&e.digest===t}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),e.exports=r.default)},72973:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),function(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}(r,{isStaticGenBailoutError:function(){return i},staticGenerationBailout:function(){return l}});let o=t(48096),n=t(45869),s="NEXT_STATIC_GEN_BAILOUT";class a extends Error{constructor(...e){super(...e),this.code=s}}function i(e){return"object"==typeof e&&null!==e&&"code"in e&&e.code===s}function c(e,r){let{dynamic:t,link:o}=r||{};return"Page"+(t?' with `dynamic = "'+t+'"`':"")+" couldn't be rendered statically because it used `"+e+"`."+(o?" See more info here: "+o:"")}let l=(e,r)=>{let{dynamic:t,link:s}=void 0===r?{}:r,i=n.staticGenerationAsyncStorage.getStore();if(!i)return!1;if(i.forceStatic)return!0;if(i.dynamicShouldError)throw new a(c(e,{link:s,dynamic:null!=t?t:"error"}));let l=c(e,{dynamic:t,link:"https://nextjs.org/docs/messages/dynamic-server-error"});if(null==i.postpone||i.postpone.call(i,e),i.revalidate=0,i.isStaticGeneration){let r=new o.DynamicServerError(l);throw i.dynamicUsageDescription=e,i.dynamicUsageStack=r.stack,r}return!1};("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),e.exports=r.default)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[1638,5665,2791,3421],()=>t(19822));module.exports=o})();